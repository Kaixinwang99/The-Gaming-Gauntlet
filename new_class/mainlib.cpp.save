#include "mainlib.h"
#include <math.h>
void mainlib::setAxis(std::array<int8_t,2> input_axis){
	axis = input_axis;
}
std::array<int8_t,2> mainlib::getAxis(void){
	return axis;
}
void mainlib::update_axis(float x, float y, float z){
    	float n,nx,ny;	if(first){
	x_offset=x;
        y_offset=y;
	z_offset=z;
	first=false;
	}
	x = x-x_offset;
	y = y-y_offset;
	z = z-z_offset; 

	n = 1/sqrt(x*x+y*y+z*z);
	nx=n*x;
	ny=n*y;

/*	if(nx<0){
	  if(nx<-0.3){
		nx=-1;
	  }
	  else{
		nx=nx/0.3;
	  }
	}
	else{
	  if(nx>0.5){
	   nx=1;
	  }
	  else{
	   nx=nx/0.5;
	  }
	}
	


	if(ny<0){
	  if(ny<-0.5){
		ny=-1;
	  }
	  else{
		ny=ny/0.5;
	  }
	}
	else{
	  if(ny>0.5){
	   ny=1;
	  }
	  else{
	   ny=ny/0.5;
	  }
	}
	
/*	nx = nx<0?nx/0.2:nx/0.2;
	ny = ny<0?ny/0.5:ny/0.5;


	nx = nx>1?1:nx;
	nx = nx<-1?-1:nx;

	ny = ny>1?1:ny;	
	ny = ny<-1?-1:ny; */
	
    	int8_t coord_x;
    	int8_t coord_y;
    	coord_x = (int8_t)(nx*127.0);
    	coord_y = (int8_t)(ny*127.0);
	raw_axis = {nx,ny};
    	axis = {coord_x,coord_y};
}
void mainlib::update_fingers(float flex_sensor[4]){
	if (flex_sensor[0]<-0.2 && abs(flex_sensor[0])<1){
		fingers[1]=true;
	}
	else if(flex_sensor[0]>0.2 && abs(flex_sensor[0])<1)
	{
		fingers[1]=false;
	}
	if (flex_sensor[1]<-0.2 && abs(flex_sensor[1])<1){
		fingers[0]=true;
	}
	else if(flex_sensor[1]>0.1 && abs(flex_sensor[1])<1){
		fingers[0]=false;
	}
	if (flex_sensor[3]<-0.2 && abs(flex_sensor[3])<1){
		fingers[2]=true;
	}
	else if (flex_sensor[3]>0.2 && abs(flex_sensor[3])<1){
		fingers[2]=false;
	}
	if (flex_sensor[2]<-0.2 && abs(flex_sensor[2])<1){
		fingers[3]=true;
	}
	else if(flex_sensor[2]>0.15 && abs(flex_sensor[2])<1){
		fingers[3]=false;
	}
}

uint8_t mainlib::match_button(void){
	uint8_t button;
	std::array<bool,4> button1 {true,false,false,false};
	std::array<bool,4> button2 {false,true,false,false};
	std::array<bool,4> button3 {false,false,true,false};
	std::array<bool,4> button4 {false,false,false,true};
	std::array<bool,4> button5 {true,true,false,false};
	std::array<bool,4> button6 {true,false,true,true};
	std::array<bool,4> button7 {true,true,true,true};
	if (fingers==button1) {
		button = 1;
	}
	else if (fingers==button2) {
		button = 2;
	}
	else if (fingers==button3) {
		button = 3;
	}
	else if (fingers==button4) {
		button = 4;
	}
	else if (fingers==button5) {
		button = 5;
	}
	else if (fingers==button6) {
		button = 6;
	}
	else if (fingers==button7) {
		button = 7;
	}
	else{
		button = 8;
	}
	return button;
}
